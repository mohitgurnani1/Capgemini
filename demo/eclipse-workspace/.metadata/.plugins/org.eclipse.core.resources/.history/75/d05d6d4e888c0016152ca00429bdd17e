package com.flp.ems.view;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.flp.ems.service.EmployeeServiceImpl;

/**
 * Servlet implementation class addServlet
 */
@WebServlet("/addServlet")
public class addServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

    /**
     * Default constructor. 
     */
    public addServlet() {
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
	
		HashMap<String, String> emp=new HashMap<String,String>();
		EmployeeServiceImpl e=new EmployeeServiceImpl();
		
		emp.put("name", request.getParameter("name"));
		emp.put("phoneNo", request.getParameter("phoneNo"));
		emp.put("address",  request.getParameter("address"));
		
		System.out.println("Enter Date of birth (format:  yyyy-mm-dd) :");
		 String dob=request.getParameter("dob");
		String dobSplit[]=dob.split("/");
		 dob=dobSplit[2]+"-"+dobSplit[0]+"-"+dobSplit[1];
		System.out.println(dob);
		 emp.put("dob", dob);
		
		System.out.println("Enter Date of Joining: (format:  yyyy-mm-dd)");
		emp.put("doj", scan.nextLine());
		
		System.out.println("Enter Department:");
		
		HashMap deptlist=e.getDepartmentList();
		if(deptlist==null){
			System.out.println("No department list found. Employee couldnt be created");
			return;
		}
		Set set=deptlist.entrySet();
		HashMap projlist;	

		for(Object dept:set)
		{
			Map.Entry<String, String> m=(Map.Entry<String, String>)dept;
			System.out.println((String)m.getValue()); 
		}
		String deptId=null;
deptNameChange:{		
		String deptName=scan.nextLine();
		deptId=null;
		boolean flagDep=false;
		for(Object dept:set)
		{
			Map.Entry<String, String> m=(Map.Entry<String, String>)dept;
			if(m.getValue().equals(deptName))
				{deptId=m.getKey();
				flagDep=true;
				break;
				}
		}
	
			if(flagDep==false){
				System.out.println("Enter Department name correctly");
				break deptNameChange;
			}
	}	
		if(deptId!=null)
		emp.put("dept",deptId );
			
		System.out.println("Enter Project:");
		
	    projlist=e.getProjectList(deptId);
		if(projlist==null || projlist.isEmpty())
			{
			System.out.println("No projects available for this department. Kindly Select another department");
			return;
			}
	
		
		Set set2=projlist.entrySet();
		for(Object proj:set2)
		{
			Map.Entry<String, String> m=(Map.Entry<String, String>)proj;
			System.out.println((String)m.getValue()); 
		}
		String projName=scan.nextLine();
		String projId=null;
		for(Object proj:set2)
		{
			Map.Entry<String, String> m=(Map.Entry<String, String>)proj;
			if(m.getValue().equals(projName))
				{projId=m.getKey();
				break;
				}
		}
		
		if(projId!=null)
		emp.put("project",projId );
		else{
			System.out.println("Enter project name correctly");
			return;
		}
	
	

	System.out.println("Enter Roles:");
		HashMap roleslist=e.getRolesList();
	
		Set set3=roleslist.entrySet();
		for(Object role:set3)
		{
			Map.Entry<String, String> m=(Map.Entry<String, String>)role;
			System.out.println((String)m.getValue()); 
		}
		String roleName=scan.nextLine();
		String roleId=null;
		for(Object role:set3)
		{
			Map.Entry<String, String> m=(Map.Entry<String, String>)role;
			if(m.getValue().equals(roleName))
				{roleId=m.getKey();
				break;
				}
		}
		
		if(roleId!=null)
		emp.put("role",roleId );
		else{
			System.out.println("Enter role name correctly");
			return;
		}
	
	
		if(e.AddEmployee(emp))
			System.out.println("Employee added successfully");
		else
			System.out.println("Employee couldnt be added");

		
		
	
	
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
